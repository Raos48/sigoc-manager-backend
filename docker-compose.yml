   version: '3.8'

   services:
     # Serviço do backend
     backend:
       build: ./backend
       volumes:
         - ./backend:/app
         - static_volume:/app/staticfiles
         - media_volume:/app/media
         - sqlite_data:/app/db
       environment:
         - DEBUG=True
         - SECRET_KEY=django-insecure-c_lb86idpic!1xbj-@!5q@0-flaxu(qbr#2g2+x+f0!e=sojco
         - ALLOWED_HOSTS=seu-dominio.com,backend,localhost
       restart: always
       networks:
         - sigoc_network
       command: >
        sh -c "chmod -R 777 /app/db &&
              chmod -R 777 /app/staticfiles &&
              chmod -R 777 /app/media &&
              python manage.py collectstatic --noinput &&
              python manage.py migrate &&
              gunicorn config.wsgi:application --bind 0.0.0.0:8000"

     # Serviço do frontend
     frontend:
       build: ./frontend/sigoc
       restart: always
       depends_on:
         - backend
       networks:
         - sigoc_network

     # Nginx para roteamento
     nginx:
       image: nginx:alpine
       ports:
         - "80:80"
         - "443:443"
       volumes:
         - ./nginx/prod.conf:/etc/nginx/conf.d/default.conf
         - static_volume:/var/www/static
         - media_volume:/var/www/media
         - ./certbot/conf:/etc/letsencrypt
         - ./certbot/www:/var/www/certbot
       depends_on:
         - backend
         - frontend
       restart: always
       networks:
         - sigoc_network

   volumes:
     sqlite_data:
     static_volume:
     media_volume:

   networks:
     sigoc_network:
       driver: bridge
